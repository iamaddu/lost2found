{% extends "layout.html" %}
{% block content %}
<div class="max-w-7xl mx-auto py-12 px-6 relative z-10">
    <div class="text-center mb-16">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-[#78BE20]/10 rounded-[2rem] mb-6">
            <i data-lucide="database" class="text-[#78BE20] w-10 h-10"></i>
        </div>
        <h1 class="text-5xl font-[900] text-slate-900 mb-4 tracking-tighter">Live Registry</h1>
        <p class="text-lg text-slate-500 font-medium max-w-2xl mx-auto">Real-time database of found assets currently
            secured within the Lost2Found network.</p>
    </div>

    {% if items %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for item in items %}
        <div
            class="glass-card rounded-[2.5rem] p-5 border border-white/50 shadow-2xl hover:-translate-y-2 transition-all duration-500 group">
            <div class="aspect-[4/3] rounded-[2rem] bg-slate-100 overflow-hidden relative mb-6">
                {% if item.image_path %}
                <img src="{{ url_for('uploaded_file', filename=item.image_path) }}"
                    class="w-full h-full object-cover group-hover:scale-110 transition duration-700">
                {% else %}
                <div class="flex items-center justify-center h-full text-slate-300">
                    <i data-lucide="image-off" class="w-12 h-12 opacity-20"></i>
                </div>
                {% endif %}

                <div
                    class="absolute top-4 right-4 bg-white/90 backdrop-blur-md px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-[0.2em] text-[#78BE20] shadow-xl border border-[#78BE20]/10">
                    Verified Found
                </div>
            </div>

            <div class="px-2">
                <h3 class="text-2xl font-black text-slate-800 mb-1 group-hover:text-[#00509E] transition-colors">{{
                    item.item_name }}</h3>
                <div class="flex items-center gap-2 text-slate-400 text-sm font-bold mb-8">
                    <i data-lucide="map-pin" class="w-4 h-4 text-[#78BE20]"></i> {{ item.location_found }}
                </div>

                <button
                    onclick="openModal('{{ item.item_name }}', '{{ item.location_found }}', '{{ item.date_found }}', '{{ url_for('uploaded_file', filename=item.image_path) if item.image_path else '' }}')"
                    class="w-full py-4 bg-slate-900 text-white rounded-2xl font-black text-sm hover:bg-[#00509E] transition-all shadow-xl flex items-center justify-center gap-2 group/btn">
                    Inspect Asset
                    <i data-lucide="scan-eye" class="w-4 h-4 group-hover/btn:rotate-12 transition"></i>
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-24 glass-card rounded-[3rem] max-w-md mx-auto">
        <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-300">
            <i data-lucide="search-x" class="w-10 h-10"></i>
        </div>
        <h3 class="text-2xl font-black text-slate-800 mb-2">Registry Empty</h3>
        <p class="text-slate-500 font-medium">No found items are currently listed in the system.</p>
    </div>
    {% endif %}
</div>

<div id="itemModal" class="fixed inset-0 z-[100] hidden">
    <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-md transition-opacity" onclick="closeModal()"></div>

    <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-md glass-card rounded-[3rem] p-8 shadow-3xl border border-white transition-all scale-100">
        <button onclick="closeModal()"
            class="absolute top-6 right-6 p-2 bg-slate-100 rounded-full hover:bg-red-50 hover:text-red-500 transition-all">
            <i data-lucide="x" class="w-5 h-5"></i>
        </button>

        <div id="modalImageContainer"
            class="aspect-video rounded-[2rem] bg-slate-50 overflow-hidden mb-8 border border-slate-100">
            <img id="modalImage" src="" class="w-full h-full object-cover hidden">
            <div id="modalNoImage"
                class="w-full h-full flex items-center justify-center text-slate-300 font-black uppercase text-xs tracking-widest hidden">
                Visual Not Available
            </div>
        </div>

        <h2 id="modalTitle" class="text-3xl font-[900] text-slate-900 mb-6 tracking-tight"></h2>

        <div class="space-y-4 mb-10">
            <div class="flex items-center gap-4 text-slate-600 font-bold text-sm">
                <div class="w-10 h-10 rounded-xl bg-[#78BE20]/10 flex items-center justify-center text-[#78BE20]">
                    <i data-lucide="map-pin" class="w-5 h-5"></i>
                </div>
                <span>Located at: <span id="modalLocation" class="text-slate-900 block font-black"></span></span>
            </div>
            <div class="flex items-center gap-4 text-slate-600 font-bold text-sm">
                <div class="w-10 h-10 rounded-xl bg-[#78BE20]/10 flex items-center justify-center text-[#78BE20]">
                    <i data-lucide="calendar" class="w-5 h-5"></i>
                </div>
                <span>Secured on: <span id="modalDate" class="text-slate-900 block font-black"></span></span>
            </div>
        </div>

        <div class="bg-[#00509E]/5 p-6 rounded-[2rem] text-center border border-[#00509E]/10">
            <p class="text-[#00509E] font-black text-sm mb-4">Is this your property?</p>
            <a href="/report_lost"
                class="block w-full py-4 bg-[#00509E] text-white rounded-2xl font-black hover:bg-[#004080] transition-all shadow-lg shadow-[#00509E]/20">
                Submit Ownership Claim
            </a>
            <p class="text-[9px] text-[#00509E]/50 mt-3 font-black uppercase tracking-[0.2em]">Cross-verification
                required</p>
        </div>
    </div>
</div>

<script>
    function openModal(title, location, date, imageSrc) {
        document.getElementById('modalTitle').innerText = title;
        document.getElementById('modalLocation').innerText = location;
        document.getElementById('modalDate').innerText = date;

        const img = document.getElementById('modalImage');
        const noImg = document.getElementById('modalNoImage');

        if (imageSrc && imageSrc !== '') {
            img.src = imageSrc;
            img.classList.remove('hidden');
            noImg.classList.add('hidden');
        } else {
            img.classList.add('hidden');
            noImg.classList.remove('hidden');
        }

        document.getElementById('itemModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden'; // Stop scrolling
    }

    function closeModal() {
        document.getElementById('itemModal').classList.add('hidden');
        document.body.style.overflow = 'auto'; // Enable scrolling
    }
</script>
{% endblock %}