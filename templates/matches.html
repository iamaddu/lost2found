{% extends "layout.html" %}
{% block content %}
<div class="max-w-5xl mx-auto py-10 px-6 relative z-10">
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-12 gap-6">
        <div>
            <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 bg-[#00509E]/10 rounded-xl flex items-center justify-center">
                    <i data-lucide="cpu" class="text-[#00509E] w-6 h-6 animate-pulse"></i>
                </div>
                <h2 class="text-4xl font-black text-slate-900 tracking-tight">Neural Matches</h2>
            </div>
            <p class="text-slate-500 font-bold ml-1">AI comparison engine has identified potential asset links.</p>
        </div>
        <a href="/dashboard"
            class="flex items-center gap-2 text-[#00509E] font-black text-sm uppercase tracking-widest hover:translate-x-1 transition-transform">
            Go to Dashboard <i data-lucide="chevron-right" class="w-4 h-4"></i>
        </a>
    </div>

    {% if matches %}
    <div class="grid md:grid-cols-2 gap-8">
        {% for match in matches %}
        <div
            class="glass-card p-6 rounded-[2.5rem] shadow-2xl shadow-[#00509E]/5 border border-white/60 hover:border-[#00509E]/30 transition-all duration-500 group">

            <div class="flex justify-between items-center mb-5">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-[#78BE20] animate-ping"></div>
                    <span class="text-[#78BE20] text-xs font-black uppercase tracking-[0.15em]">
                        {{ match.confidence }}% Probability Match
                    </span>
                </div>
                <span class="text-slate-400 text-[10px] font-black uppercase">{{ match.item.date_found }}</span>
            </div>

            <div
                class="relative group/img overflow-hidden rounded-[1.5rem] mb-6 aspect-video bg-slate-100 border border-slate-100">
                {% if match.item.image_path %}
                <img src="{{ url_for('uploaded_file', filename=match.item.image_path) }}"
                    class="w-full h-full object-cover group-hover/img:scale-105 transition duration-700">

                <div class="absolute inset-0 bg-[#00509E]/40 opacity-0 group-hover/img:opacity-100 transition-all duration-300 flex items-center justify-center backdrop-blur-[2px] cursor-pointer"
                    onclick="openModal('{{ url_for('uploaded_file', filename=match.item.image_path) }}')">
                    <button
                        class="bg-white text-[#00509E] px-5 py-2.5 rounded-xl font-black text-xs shadow-2xl transform translate-y-4 group-hover/img:translate-y-0 transition-all duration-300">
                        <i data-lucide="maximize" class="inline w-3 h-3 mr-1"></i> Full Inspection
                    </button>
                </div>
                {% else %}
                <div class="w-full h-full flex flex-col items-center justify-center text-slate-300 gap-2">
                    <i data-lucide="image-off" class="w-8 h-8 opacity-20"></i>
                    <span class="text-[10px] font-black uppercase tracking-widest">No Visual Data</span>
                </div>
                {% endif %}
            </div>

            <div class="mb-6">
                <h3 class="text-2xl font-black text-slate-800 tracking-tight">{{ match.item.item_name }}</h3>
                <div class="flex items-center gap-2 text-slate-400 font-bold text-sm mt-1">
                    <i data-lucide="map-pin" class="w-4 h-4 text-[#78BE20]"></i>
                    {{ match.item.location_found }}
                </div>
            </div>

            <form action="{{ url_for('claim', fid=match.item.id, lid=lost_id) }}" method="POST"
                class="pt-6 border-t border-slate-100/50">
                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-3">Ownership
                    Evidence</label>
                <textarea name="proof"
                    placeholder="Describe unique features (scratches, case type, specific details)..." required
                    class="w-full p-4 bg-white/50 rounded-[1.25rem] mb-4 text-sm font-bold text-slate-700 outline-none border border-slate-200 focus:border-[#00509E] focus:ring-4 focus:ring-[#00509E]/5 transition-all min-h-[100px]"></textarea>

                <button type="submit"
                    class="w-full py-4 bg-[#00509E] text-white rounded-2xl font-black text-sm hover:bg-[#004080] shadow-xl shadow-[#00509E]/20 transition-all active:scale-[0.98] flex items-center justify-center gap-2">
                    <i data-lucide="shield-check" class="w-4 h-4"></i>
                    Initiate Recovery Claim
                </button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="glass-card p-16 rounded-[3rem] text-center border border-white max-w-2xl mx-auto">
        <div class="w-20 h-20 bg-slate-50 rounded-[2rem] flex items-center justify-center mx-auto mb-6">
            <i data-lucide="radar" class="w-10 h-10 text-slate-300"></i>
        </div>
        <h3 class="text-3xl font-[900] text-slate-900 mb-3 tracking-tight">Zero Immediate Matches</h3>
        <p class="text-slate-500 font-bold mb-8 max-w-sm mx-auto">Our neural network didn't find a direct hit yet. We'll
            keep scanning and alert you the second it appears.</p>
        <a href="/dashboard"
            class="inline-flex items-center gap-2 px-10 py-4 bg-[#00509E] text-white rounded-2xl font-black shadow-xl shadow-[#00509E]/20 hover:bg-[#004080] transition-all">
            Return to Dashboard
        </a>
    </div>
    {% endif %}
</div>

<div id="imageModal"
    class="fixed inset-0 z-[100] hidden bg-slate-900/90 backdrop-blur-md flex items-center justify-center p-6"
    onclick="closeModal()">
    <div class="relative max-w-5xl w-full animate-in zoom-in duration-300" onclick="event.stopPropagation()">
        <button onclick="closeModal()"
            class="absolute -top-14 right-0 text-white font-black flex items-center gap-2 hover:text-[#78BE20] transition-colors">
            CLOSE <i data-lucide="x-circle" class="w-6 h-6"></i>
        </button>
        <img id="modalImage" src="" class="w-full h-auto rounded-[2rem] shadow-3xl border-4 border-white/10">
    </div>
</div>

<script>
    function openModal(imageSrc) {
        document.getElementById('modalImage').src = imageSrc;
        document.getElementById('imageModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    function closeModal() {
        document.getElementById('imageModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }
</script>
{% endblock %}